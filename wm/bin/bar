#!/usr/bin/env bash
#
# started from https://github.com/MarinHoc/dotfiles

# set values
a="%{F#FF99A1}"
n="%{F-}"

workspaces() {
    cur=$(bspc wm -g | grep -o '[OFU][1-5]' | tail -c2)
    case "$cur" in
        1) echo "${a}${n}";;
        2) echo "${a}${n}";;
        3) echo "${a}${n}";;
        4) echo "${a}${n}";;
        5) echo "${a}${n}";;
    esac
}

clock() {
    echo "${a}${n} $(date +'%a %R')"
}

network() {
    cur=$(iwgetid -r)
    [ -z "$cur" ] && cur=Offline
    echo "${a}${n} ${cur}"
}

volume() {
    # amixer slowness workaround
    cur=$(amixer sget Master)
    if echo "$cur" | grep -q off; then
        echo "${a}${n} Muted"
    else
        cur=$(echo "$cur" | grep -om1 '[0-9]*%')
        echo "${a}${n} ${cur}"
    fi
}

brightness() {
    cur=$(xbacklight -get | xargs printf '%0.0f')
    echo "${a}${n} ${cur}%"
}

battery() {
    cur=$(cat /sys/class/power_supply/BAT0/capacity)
    if [ "$cur" -eq 100 ]; then
        echo "${a}${n} ${cur}%"
    elif [ "$cur" -gt 75 ]; then
        echo "${a}${n} ${cur}%"
    elif [ "$cur" -gt 25 ]; then
        echo "${a}${n} ${cur}%"
    else
        echo "${a}${n} ${cur}%"
    fi
}

# create bar
while echo "%{l}  $(workspaces)%{c}$(clock)%{r}$(network)  $(volume)  $(brightness)  $(battery)  "
do sleep .2s
done |\
    lemonbar -g x30 \
        -f "-uw-ttyp0-medium-r-*-*-*-120-*-*-*-*-iso8859-1" \
        -f "-wuncon-siji-medium-r-normal--10-100-75-75-c-80-iso10646-1" \
        -B \#080808 \
        -F \#E8DFD6
#URxvt.font: -uw-ttyp0-medium-r-*-*-*-160-*-*-*-*-*-*
#URxvt.boldFont: -uw-ttyp0-bold-r-*-*-*-160-*-*-*-*-*-*

# vim: ft=sh
